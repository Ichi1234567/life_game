var moverule=function(q,p){var g=p.empty,l=p.role,m=function(d,f){var e=d.pos;d.licycle++;e=f[e.x][e.y];for(var a=e.nei,b=0,c=0;c<a.length;c++){var j=a[c],h=j.x;j=j.y;if(typeof f[h][j]=="object"&&f[h][j].cell.type=="role"){h=f[h][j].cell.ghost;typeof h=="number"&&!h&&b++}}e.cell.type=="role"&&b--;return b},k={};k.twoxtwo=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 2:case 5:break;default:e[b][c].cell=new g(a)}return e};k.conway=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,
f)){case 2:case 3:break;default:e[b][c].cell=new g(a)}return e};k.flakes=function(){};k.maze=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 2:case 3:case 4:case 5:break;default:e[b][c].cell=new g(a)}};k.replicator=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 3:case 5:case 7:break;default:e[b][c].cell=new g(a)}};k.logic=function(d,f,e){var a=d.pos,b=a.x,c=a.y;m(d,f);e[b][c].cell=new g(a)};k.brainbrain=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:d.type==
"ghost"&&e[b][c].cell.ghost++;break;default:e[b][c].cell.type="ghost";e[b][c].cell.ghost++}if(d.ghost==2){d.ghost=0;e[b][c].cell=new g(a)}};k.banners=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:case 3:case 6:case 7:d.type=="ghost"&&e[b][c].cell.ghost++;break;default:e[b][c].cell.type="ghost";e[b][c].cell.ghost++}if(d.ghost==4){d.ghost=0;e[b][c].cell=new g(a)}};k.ebbflow=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 2:case 4:case 7:case 8:d.type=="ghost"&&e[b][c].cell.ghost++;
break;default:e[b][c].cell.type="ghost";e[b][c].cell.ghost++}if(d.ghost==17){d.ghost=0;e[b][c].cell=new g(a)}};k.fireworks=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:d.type=="ghost"&&e[b][c].cell.ghost++;break;default:e[b][c].cell.type="ghost";e[b][c].cell.ghost++}if(d.ghost==20){d.ghost=0;e[b][c].cell=new g(a)}};k.rake=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 3:case 4:case 6:case 7:d.type=="ghost"&&e[b][c].cell.ghost++;break;default:e[b][c].cell.type="ghost";
e[b][c].cell.ghost++}if(d.ghost==5){d.ghost=0;e[b][c].cell=new g(a)}};k.spirals=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:d.type=="ghost"&&e[b][c].cell.ghost++;break;default:e[b][c].cell.type="ghost";e[b][c].cell.ghost++}if(d.ghost==4){d.ghost=0;e[b][c].cell=new g(a)}};var i={};i.twoxtwo=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 3:case 6:e[b][c].cell=new l(a)}return e};i.conway=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 3:e[b][c].cell=new l(a)}return e};
i.flakes=i.conway;i.maze=i.conway;i.replicator=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 3:case 5:case 7:e[b][c].cell=new l(a)}};i.logic=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:e[b][c].cell=new l(a)}};i.brainbrain=i.logic;i.banners=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 3:case 4:case 5:case 7:d.ghost=0;e[b][c].cell=new l(a)}};i.ebbflow=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 3:case 6:d.ghost=0;e[b][c].cell=new l(a)}};
i.fireworks=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 1:case 3:d.ghost=0;e[b][c].cell=new l(a)}};i.rake=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:case 6:case 7:case 8:d.ghost=0;e[b][c].cell=new l(a)}};i.spirals=function(d,f,e){var a=d.pos,b=a.x,c=a.y;switch(m(d,f)){case 2:case 3:case 4:d.ghost=0;e[b][c].cell=new l(a)}};q.roleRule=k;q.emptyRule=i;q.foodRule={};q.enemyRule={}},setcell=function(q,p){q.prototype.setcell=function(g,l){var m=this.celltabsize,k=parseInt(g.x/
m)+1;k=g.x%m?k:k-1;var i=parseInt(g.y/m)+1;i=g.y%m?i:i-1;this.celltab[k][i].cell=p(l,{x:k,y:i});this.draw(this)};q.prototype.clear=function(){var g=this.h,l=this.celltabsize,m=parseInt(this.w/l);g=parseInt(g/l);l=[];for(var k=0;k<m+3;k++){l[k]=[];for(var i=0;i<g+3;i++)if(k&&i&&k<m+2&&i<g+2){l[k][i]={};l[k][i].guess={x:0,y:0};l[k][i].nei=[];for(var d=-1;d<2;d++)for(var f=-1;f<2;f++)l[k][i].nei.push({x:k+d,y:i+f});l[k][i].cell=p("empty",{x:k,y:i})}else l[k][i]=-1}this.celltab=l;this.draw(this)}},celtype=
function(q){var p=function(e,a){return new i[e](a)},g=function(e){this.type="food";this.pos=e;this.speed=1.5;this.ghost=this.licycle=0};g.prototype.move=function(){};var l=function(e){this.type="enemy";this.pos=e;this.speed=3;this.ghost=this.licycle=0};l.prototype.move=function(){};var m=function(e){this.type="role";this.pos=e;this.speed=2;this.ghost=this.licycle=0};m.prototype.move=function(e,a,b){d[a](this,e,b)};var k=function(e){this.type="empty";this.pos=e;this.ghost=this.licycle=this.speed=0};
k.prototype.move=function(e,a,b){f[a](this,e,b)};var i={food:g,enemy:l,role:m,empty:k};moverule(p,i);var d=p.roleRule,f=p.emptyRule;q.cell=p},tablemath=function(q){var p={food:{x:[0.5,1,0,-1,-0.5],y:[-0.5,-1,0,1,0.5]},enemy:{x:[-1,-2,-3,0,3,2,1],y:[1,2,,3,0,-3,-2,-1]}};q.updateSt=function(g,l){var m=g.pos,k=g.type,i=p[k],d=m.x;m=m.y;var f,e;for(f=1;f<l.length-1;f++)for(e=1;e<talbe[f].length-1;e++){var a=l[d+f][m+e];a.guess={x:0.5*a.guess.x,y:0.5*a.guess.y}}switch(k){case "food":case "enemy":e=i.x.length;
a=i.y.length;f=0-(e-1)/2;i=0-(a-1)/2;k=e+f;var b=a+i;for(f=f;f<k;f++)for(e=i;e<b;e++){a=l[d+f][m+e];if(typeof a=="object")a.guess={x:a.guess.x+0.5*foodFilter.x[f],y:a.guess.y+0.5*foodFilter.y[e]}}}return l}};
(function(q){var p,g,l=Object.prototype.toString,m=function(a,b){var c,j;c=l.call(a);b=l.call(b)==="[object Array]"?b:null;switch(c){case "[object Array]":j=[];a.foreach=k;c=function(h,o,n){n.push(o);return n};j=a.foreach(c,j);break;case "[object Object]":a.foreach=k;if(b)j=b.toString();c=function(h,o,n,r){var s=true;if(n)s=n.indexOf(h)<0?false:true;if(s)r[h]=o;return r};j=a.foreach(c,[j],{});break;default:j=a}i.func(j.foreach)&&delete j.foreach;return j},k=function(a,b,c){var j,h,o=this.length;h=
i.arr(this)?true:false;var n=i.arr(b)&&b.length?b:[];b=!n.length&&typeof b!="undefined"?b:typeof c!="undefined"?c:null;c=b!=null?true:false;if(h)for(j=0;j<o;j++){h=Array.prototype.slice.call(n);h.splice(0,0,j,this[j]);c&&h.push(b);b=a.apply(this[j],h);if(b==false)break}else for(j in this){h=Array.prototype.slice.call(n);h.splice(0,0,j,this[j]);c&&h.push(b);b=a.apply(this[j],h);if(b==false)break}c||(b=this);return b},i={"null":function(a){return a==null},undefined:function(a){return typeof a=="undefined"},
num:function(a){return l.call(a)==="[object Number]"&&isFinite(a)},str:function(a){return typeof a=="string"||l.call(a)==="[object String]"},bool:function(a){return typeof a=="boolean"||l.call(a)==="[object Boolean]"},reg:function(a){return l.call(a)==="[object RegExp]"},date:function(a){return l.call(a)==="[object Date]"},func:function(a){return l.call(a)==="[object Function]"},obj:function(a){return l.call(a)==="[object Object]"},arr:function(a){return l.call(a)==="[object Array]"}},d=function(){return new f},
f=function(){p=document.getElementById("evn");g=p.getContext("2d");this.celltabsize=15;this.h=this.w=600;this.mode="default";this.timmer=this.celltab=null};f.prototype.reset=function(){var a=this.h,b=this.celltabsize,c=[],j=parseInt(this.w/b);a=parseInt(a/b);for(b=0;b<j+3;b++){c[b]=[];for(var h=0;h<a+3;h++){var o=Math.random();if(b&&h&&b<j+2&&h<a+2){c[b][h]={};c[b][h].guess={x:0,y:0};c[b][h].nei=[];for(var n=-1;n<2;n++)for(var r=-1;r<2;r++)c[b][h].nei.push({x:b+n,y:h+r});c[b][h].cell=o>0.9?e("role",
{x:b,y:h}):e("empty",{x:b,y:h})}else c[b][h]=-1}}this.celltab=c;this.draw()};f.prototype.draw=function(a){a=typeof a=="object"?a:this;g.strkeStyle="#000000";g.fillStyle="#ffffff";g.clearRect(0,0,a.w,a.h);var b=a.w,c=a.h,j=a.celltabsize,h,o,n;g.strokeStyle="#000000";o=b/j;for(h=0;h<o;h++){n=h*j;g.beginPath();g.moveTo(n,0);g.lineTo(n,c);g.closePath();g.stroke()}o=c/j;for(h=0;h<o;h++){c=h*j;g.beginPath();g.moveTo(0,c);g.lineTo(b,c);g.closePath();g.stroke()}j=b=a.celltabsize;a=a.celltab;for(c=1;c<a.length-
2;c++)for(n=1;n<a.length-2;n++)if(typeof a[c][n].cell=="object"){h=b*(c-1);o=j*(n-1);var r=a[c][n].cell,s=r.ghost;switch(r.type){case "food":g.fillStyle="#00ff00";break;case "enemy":g.fillStyle="#ff0000";break;case "role":g.fillStyle="#000000";break;case "empty":g.fillStyle="#ffffff";break;default:if(s){r=parseInt(16/(s+1)).toString(16);s="#";for(var t=0;t<6;t++)s+=r;g.fillStyle=s}}g.beginPath();g.rect(h,o,b,j);g.closePath();g.fill();g.stroke()}};f.prototype.start=function(a,b){a.timmer=setInterval(function(){var c,
j,h=a.w/a.celltabsize+3,o=a.celltab,n=[];for(c=0;c<h;c++){n[c]=[];for(j=0;j<h;j++){n[c][j]=m(o[c][j]);typeof o[c][j]=="object"&&o[c][j].cell.move(o,b,n)}}a.celltab=n;a.draw(a)},200)};f.prototype.pause=function(a){clearInterval(a.timmer)};celtype(d);q.LG=d;var e=d.cell;setcell(f,e)})(window);
